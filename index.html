<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="很乱">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="很乱">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="魏彬">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>
<title>Hexo</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">魏彬的仓库</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="魏彬"
      src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=558582640,2047403197&fm=27&gp=0.jpg">
  <p class="site-author-name" itemprop="name">魏彬</p>
  <div class="site-description" itemprop="description">很乱</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">96</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/14/%E5%89%8D%E7%AB%AF%E6%8F%90%E5%8F%96%E8%A7%86%E9%A2%91%E4%B8%AD%E5%B8%A7%E7%9A%84%E5%9B%BE%E7%89%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=558582640,2047403197&fm=27&gp=0.jpg">
      <meta itemprop="name" content="魏彬">
      <meta itemprop="description" content="很乱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/09/14/%E5%89%8D%E7%AB%AF%E6%8F%90%E5%8F%96%E8%A7%86%E9%A2%91%E4%B8%AD%E5%B8%A7%E7%9A%84%E5%9B%BE%E7%89%87/" class="post-title-link" itemprop="url">前端使用canvas提取视频中帧的图片/图片上传本地预览</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-09-14 14:13:23" itemprop="dateCreated datePublished" datetime="2023-09-14T14:13:23+08:00">2023-09-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2023-09-15 15:22:16" itemprop="dateModified" datetime="2023-09-15T15:22:16+08:00">2023-09-15</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/js/" itemprop="url" rel="index"><span itemprop="name">js</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前端使用canvas提取视频中帧的图片"><a href="#前端使用canvas提取视频中帧的图片" class="headerlink" title="前端使用canvas提取视频中帧的图片"></a>前端使用canvas提取视频中帧的图片</h1><h3 id="首先是html"><a href="#首先是html" class="headerlink" title="首先是html"></a>首先是html</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    img&#123;</span><br><span class="line">        width: 300px;</span><br><span class="line">        height: 600px;</span><br><span class="line">        display: block;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;videoFile&quot; id&#x3D;&quot;videoFileInput&quot;&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var inputObj &#x3D; document.querySelector(&quot;#videoFileInput&quot;);</span><br><span class="line">inputObj.addEventListener(&quot;change&quot;,async function (file) &#123;</span><br><span class="line">     &#x2F;&#x2F;每隔1秒创建一张图片 从0秒到4秒逐帧创建</span><br><span class="line">     for(var i&#x3D;0; i&lt; 5; i++) &#123;</span><br><span class="line">        const frame &#x3D; await captureFrame(file.target.files[0],i * 1)</span><br><span class="line">        &#x2F;&#x2F;拿到图片的blob和url 就可以在页面绘制图片了</span><br><span class="line">        createImg(frame)</span><br><span class="line">     &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h3><ul>
<li>从调用方法里接受一个视频文件，创建一个视频对象。通过URL.createObjectURL 可以创建出本地的视频地址</li>
<li>使用canvas绘制视频 并且HTMLCanvasElement.toBlob()方法可以创建blob 有了blob 通过URL.createObjectURL又可以有 URL</li>
<li>转换链条 canvas ==&gt; blob ==&gt; file对象 ==&gt;上传</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">function captureFrame(vdoFile,time&#x3D;0)&#123;</span><br><span class="line"></span><br><span class="line">    return new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">        const vdo &#x3D; document.createElement(&#39;video&#39;);</span><br><span class="line">        vdo.currentTime &#x3D; time;</span><br><span class="line">        vdo.muted &#x3D; true;</span><br><span class="line">        &#x2F;&#x2F;由于此时浏览器没有加载视频，所以自动播放只播放当前这一帧就结束了，这样就可以让视频定格在我们指定的时间。</span><br><span class="line">        vdo.autoplay &#x3D; true;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;通过URL.createObjectURL生成本地URL 可以传入一个file对象或者一个blob</span><br><span class="line">        &#x2F;&#x2F;这个 URL 的生命周期和创建它的窗口中的 document 绑定。也就是说关掉窗口这个时候,URL 就会被释放。</span><br><span class="line">        &#x2F;&#x2F;这个创建出来会是一个blob:xxxxx 放到浏览器可以直接访问，关闭掉页面窗口就销毁了</span><br><span class="line">        vdo.src &#x3D; URL.createObjectURL(vdoFile)</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F;开始用canvas画视频,当视频可以播放的时候再话，因为可能视频没有加载完</span><br><span class="line">        vdo.addEventListener(&#39;canplay&#39;, async function () &#123;</span><br><span class="line">            const frame &#x3D; await drawVideo(vdo)</span><br><span class="line">            resolve(frame)</span><br><span class="line">            </span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function drawVideo(vdo) &#123;</span><br><span class="line">    return new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">        const cvs &#x3D; document.createElement(&#39;canvas&#39;);    </span><br><span class="line">        cvs.width &#x3D; vdo.videoWidth;</span><br><span class="line">        cvs.height &#x3D; vdo.videoHeight;</span><br><span class="line"></span><br><span class="line">        const ctx &#x3D; cvs.getContext(&#39;2d&#39;);</span><br><span class="line">        ctx.drawImage(vdo, 0, 0, cvs.width, cvs.height);</span><br><span class="line">      </span><br><span class="line">        &#x2F;&#x2F;这个方法是让canvas转换为blob 是个异步方法，所以要用promise</span><br><span class="line">        &#x2F;**</span><br><span class="line">         * @returns &#123;Promise&#125; 1个视频的的file对象 可以上传 1个url可以用作预览</span><br><span class="line">         * url可以当做本地预览图片地址</span><br><span class="line">         * blob可以用户选中了这个图片后上传使用</span><br><span class="line">         *&#x2F;</span><br><span class="line">        cvs.toBlob(blob &#x3D;&gt; &#123;</span><br><span class="line">            resolve(&#123;</span><br><span class="line">                file:new File([blob], &quot;test.png&quot;, &#123;type:&quot;image&#x2F;png&quot;&#125;),</span><br><span class="line">                url: URL.createObjectURL(blob)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function createImg(frame)&#123;</span><br><span class="line">    </span><br><span class="line">    const img &#x3D; document.createElement(&quot;img&quot;);</span><br><span class="line">    img.src &#x3D; frame.url;</span><br><span class="line">    document.body.appendChild(img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="本地图片上传预览"><a href="#本地图片上传预览" class="headerlink" title="本地图片上传预览"></a>本地图片上传预览</h1><ul>
<li>使用 FileReader 的 readAsDataURL 方法读取file对象，转为base64，就可以给img的src赋值了<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const vdoInput &#x3D; document.querySelector(&quot;#videoFileInput&quot;);</span><br><span class="line"></span><br><span class="line">vdoInput.addEventListener(&quot;change&quot;, async (e) &#x3D;&gt; &#123;</span><br><span class="line">    const file &#x3D; e.target.files[0];</span><br><span class="line">    const reader &#x3D; new FileReader();</span><br><span class="line">    reader.onload &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class="line">       createImg(e.target.result)</span><br><span class="line">    &#125;</span><br><span class="line">    reader.readAsDataURL(file);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">function createImg(data) &#123;</span><br><span class="line">    const img &#x3D; document.createElement(&quot;img&quot;);</span><br><span class="line">    img.src &#x3D; data;</span><br><span class="line">    document.body.appendChild(img);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/22/vue_%E6%8D%A2%E8%82%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=558582640,2047403197&fm=27&gp=0.jpg">
      <meta itemprop="name" content="魏彬">
      <meta itemprop="description" content="很乱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/22/vue_%E6%8D%A2%E8%82%A4/" class="post-title-link" itemprop="url">vue3 换肤思路</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-05-22 14:13:23 / Modified: 14:48:10" itemprop="dateCreated datePublished" datetime="2023-05-22T14:13:23+08:00">2023-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/vue/" itemprop="url" rel="index"><span itemprop="name">vue</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="我们使用CSS变量来实现换肤是最方便的"><a href="#我们使用CSS变量来实现换肤是最方便的" class="headerlink" title="我们使用CSS变量来实现换肤是最方便的"></a>我们使用CSS变量来实现换肤是最方便的</h3><p><strong>创建CSS</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;主题色设置 root代表默认主题色， html[data-theme]代表另一种主题色</span><br><span class="line">:root&#123;</span><br><span class="line">  --main-color: hotpink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">html[data-theme&#x3D;&#39;dark&#39;] &#123;</span><br><span class="line">  --main-color: #000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;主题色应用</span><br><span class="line">body&#123;</span><br><span class="line">  background-color: var(--main-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>设置好css 在main.js中引入</p>
</blockquote>
<p><strong>我们使用hooks来创建一个theme代替使用vuex</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref, watchEffect &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">const theme &#x3D; ref(localStorage.getItem(&quot;_theme_&quot;)) || ref(&quot;light&quot;);</span><br><span class="line"></span><br><span class="line">watchEffect(() &#x3D;&gt; &#123;</span><br><span class="line">  document.documentElement.dataset.theme &#x3D; theme.value;</span><br><span class="line">  localStorage.setItem(&quot;_theme_&quot;, theme.value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default function useTheme() &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    theme</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里的思想就是从本地缓存中读取 theme 在他发生更改的时候设置html的 data-theme属性，从而能使用到我们的第一步设置的CSS</p>
</blockquote>
<p><strong>随便写一个更改主体的组件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;input</span><br><span class="line">    :checked&#x3D;&quot;theme &#x3D;&#x3D; &#39;light&#39;&quot;</span><br><span class="line">    @click&#x3D;&quot;changeTheme(&#39;light&#39;)&quot;</span><br><span class="line">    type&#x3D;&quot;radio&quot;</span><br><span class="line">    id&#x3D;&quot;light&quot;</span><br><span class="line">    name&#x3D;&quot;theme&quot;</span><br><span class="line">  &#x2F;&gt;&lt;label for&#x3D;&quot;light&quot;&gt;light&lt;&#x2F;label&gt;</span><br><span class="line">  &lt;input</span><br><span class="line">    type&#x3D;&quot;radio&quot;</span><br><span class="line">    :checked&#x3D;&quot;theme &#x3D;&#x3D; &#39;dark&#39;&quot;</span><br><span class="line">    @click&#x3D;&quot;changeTheme(&#39;dark&#39;)&quot;</span><br><span class="line">    id&#x3D;&quot;dark&quot;</span><br><span class="line">    name&#x3D;&quot;theme&quot;</span><br><span class="line">  &#x2F;&gt;&lt;label for&#x3D;&quot;dark&quot;&gt;dark&lt;&#x2F;label&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import useTheme from &quot;..&#x2F;useTheme.js&quot;;</span><br><span class="line">const &#123; theme &#125; &#x3D; useTheme();</span><br><span class="line"></span><br><span class="line">const changeTheme &#x3D; (params) &#x3D;&gt; &#123;</span><br><span class="line">  theme.value &#x3D; params;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/22/%E6%B8%A1%E4%B8%80%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=558582640,2047403197&fm=27&gp=0.jpg">
      <meta itemprop="name" content="魏彬">
      <meta itemprop="description" content="很乱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/22/%E6%B8%A1%E4%B8%80%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E7%82%B9/" class="post-title-link" itemprop="url">前端零碎知识点</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-05-22 14:13:23" itemprop="dateCreated datePublished" datetime="2023-05-22T14:13:23+08:00">2023-05-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2023-11-17 17:45:33" itemprop="dateModified" datetime="2023-11-17T17:45:33+08:00">2023-11-17</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/js/" itemprop="url" rel="index"><span itemprop="name">js</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="使用SCSS-优化媒体查询"><a href="#使用SCSS-优化媒体查询" class="headerlink" title="使用SCSS 优化媒体查询"></a>使用SCSS 优化媒体查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">    使用SCSS 优化媒体查询</span><br><span class="line">    @content 代表使用@mixin传入的CSS</span><br><span class="line">    $breakpoints 代表在SASS中定义一个MAP,</span><br><span class="line">    $bp:map-get($breakpoints, $breakpoints );代表定义一个变量$bp,在SASS中获取这个MAP，第一个参数是这个MAP，第二个参数是这个MAP的key</span><br><span class="line">    $min:nth($bp, 1 ); 定义一个变量$min 取$bp这个数组的第一个值</span><br><span class="line">**&#x2F;</span><br><span class="line">.header &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (min-width: 320px) and (max-width: 480px) &#123;</span><br><span class="line">  .header &#123;</span><br><span class="line">    width: 50px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (min-width: 481px) and (max-width: 768px) &#123;</span><br><span class="line">  .header &#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>编译结果<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.header &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (min-width: 320px) and (max-width: 480px) &#123;</span><br><span class="line">  .header &#123;</span><br><span class="line">    width: 50px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (min-width: 481px) and (max-width: 768px) &#123;</span><br><span class="line">  .header &#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="clip-path-裁切图片的用法-http-tools-jb51-net-code-css3path"><a href="#clip-path-裁切图片的用法-http-tools-jb51-net-code-css3path" class="headerlink" title="clip-path 裁切图片的用法 http://tools.jb51.net/code/css3path"></a>clip-path 裁切图片的用法 <a target="_blank" rel="noopener" href="http://tools.jb51.net/code/css3path">http://tools.jb51.net/code/css3path</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.clipPath &#123;</span><br><span class="line">     width: 500px;</span><br><span class="line">     height: 400px;</span><br><span class="line">&#125;</span><br><span class="line">.clipPath img&#123;</span><br><span class="line"> width: 100%;</span><br><span class="line"> height: 100%;</span><br><span class="line"> transition: all 1s;</span><br><span class="line"> clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);</span><br><span class="line">&#125;</span><br><span class="line">.clipPath:hover img&#123;</span><br><span class="line"> clip-path: polygon(100% 0%, 100% 100%, 0% 100%, 0% 0%);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &lt;div class&#x3D;&quot;clipPath&quot;&gt;</span><br><span class="line"> &lt;img src&#x3D;&quot;https:&#x2F;&#x2F;pic.xcar.com.cn&#x2F;img&#x2F;07news&#x2F;23&#x2F;11&#x2F;15&#x2F;1865fe8da72410a1d7bcb81849af78ff.jpg?imageMogr2&#x2F;format&#x2F;jpg&#x2F;size-limit&#x2F;150k!&#x2F;ignore-error&#x2F;1&quot; alt&#x3D;&quot;&quot;&gt;</span><br><span class="line"> &lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h2 id="IntersectionObserver-用来判断元素是否在可视范围内"><a href="#IntersectionObserver-用来判断元素是否在可视范围内" class="headerlink" title="IntersectionObserver 用来判断元素是否在可视范围内"></a>IntersectionObserver 用来判断元素是否在可视范围内</h2><p>html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">    &lt;style&gt;</span><br><span class="line">        ul&#123;</span><br><span class="line">            list-style: none;</span><br><span class="line">            display: flex;</span><br><span class="line">            flex-wrap: wrap;</span><br><span class="line">            width: 600px;</span><br><span class="line">            margin: 0 auto;</span><br><span class="line">        &#125;</span><br><span class="line">        ul li &#123;</span><br><span class="line">            width: 200px;</span><br><span class="line">            margin: 30px;</span><br><span class="line">        &#125;</span><br><span class="line">        ul li img &#123;</span><br><span class="line">            width: 100%;</span><br><span class="line">            height: 100%;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;&#x2F;style&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;&#x2F;ul&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;.&#x2F;IntersectionObserver.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>IntersectionObserver.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var ul &#x3D; document.querySelector(&#39;ul&#39;)</span><br><span class="line">var ob &#x3D; new IntersectionObserver(items&#x3D;&gt;&#123;</span><br><span class="line">    for(const item of items) &#123;</span><br><span class="line">        &#x2F;&#x2F; item.isIntersecting 为true 代表item出现在视窗内，false代表不在视窗内</span><br><span class="line">        &#x2F;&#x2F; item.target是元素本身</span><br><span class="line">        console.log(item.isIntersecting,item.target)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">for (var i&#x3D;0; i&lt;20; i++) &#123;</span><br><span class="line">    var item &#x3D; document.createElement(&#39;li&#39;);</span><br><span class="line">    var img &#x3D; document.createElement(&#39;img&#39;)</span><br><span class="line">    img.src &#x3D; &#39;https:&#x2F;&#x2F;picsum.photos&#x2F;200&#x2F;300?random&#x3D;&#39; + i;</span><br><span class="line">    item.appendChild(img)</span><br><span class="line">    item.dataset.index &#x3D; i +1;</span><br><span class="line">    </span><br><span class="line">    ul.appendChild(item);</span><br><span class="line">    ob.observe(item)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="滚动到相应位置"><a href="#滚动到相应位置" class="headerlink" title="滚动到相应位置"></a>滚动到相应位置</h2><ul>
<li>使用传统的锚点方式 会产生一个 <code>#</code> 如果你使用的是VUE,REACT 这种方式和HASH路由有冲突</li>
<li>可以使用 Element.scrollIntoView()<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">可以使用 Element.scrollIntoView(&#123;</span><br><span class="line">    behavior:&#39;smooth&#39;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="抛物线小球-加入购物车效果"><a href="#抛物线小球-加入购物车效果" class="headerlink" title="抛物线小球 (加入购物车效果)"></a>抛物线小球 (加入购物车效果)</h2><ul>
<li>让父元素做横向运 动，子元素做向上抛物线运动，两个运动结合就产生了购物车那种抛物线小球</li>
<li>内部小球调整贝塞尔曲线。让他先反向再正向运动<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;ball&quot;&gt;</span><br><span class="line">       &lt;div class&#x3D;&quot;innerBall&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">   .ball&#123;</span><br><span class="line">       position: fixed;</span><br><span class="line">       width: 50px;</span><br><span class="line">       height: 50px;</span><br><span class="line">       border-radius: 50%;</span><br><span class="line">       background-color: red;</span><br><span class="line">       top: 100px;</span><br><span class="line">       left: 300px;</span><br><span class="line">       border: 2px solid #000;</span><br><span class="line">       animation: moveX 2s linear forwards;</span><br><span class="line">       z-index: 100;</span><br><span class="line">   &#125;</span><br><span class="line">   .innerBall&#123;</span><br><span class="line">       width: 100%;</span><br><span class="line">       height: 100%;</span><br><span class="line">       border-radius: 50%;</span><br><span class="line">       background-color: red;</span><br><span class="line">       animation: moveY 2s cubic-bezier(0.3, -0.49, 0.32, 1.28) forwards;</span><br><span class="line">   &#125;</span><br><span class="line">   @keyframes moveX &#123;</span><br><span class="line">       to&#123;</span><br><span class="line">           transform: translateX(200px);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @keyframes moveY &#123;</span><br><span class="line">       to&#123;</span><br><span class="line">           transform: translateY(400px);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







</li>
</ul>
<h2 id="setup的子组件如果需要暴露自己的属性和方法给父组件-需要使用-defineExpose-，父组件用-在mounted中-用子组件-value可以使用"><a href="#setup的子组件如果需要暴露自己的属性和方法给父组件-需要使用-defineExpose-，父组件用-在mounted中-用子组件-value可以使用" class="headerlink" title="setup的子组件如果需要暴露自己的属性和方法给父组件 需要使用 defineExpose ，父组件用 在mounted中 用子组件.value可以使用"></a>setup的子组件如果需要暴露自己的属性和方法给父组件 需要使用 defineExpose ，父组件用 在mounted中 用子组件.value可以使用</h2><h2 id="object-fit-给图片设置-cover-contain"><a href="#object-fit-给图片设置-cover-contain" class="headerlink" title="object-fit 给图片设置 cover.,,contain"></a>object-fit 给<img>图片设置 cover.,,contain</h2><h2 id="background-clip-可以给文字设置透明（透明出下边的背景图）"><a href="#background-clip-可以给文字设置透明（透明出下边的背景图）" class="headerlink" title="background-clip 可以给文字设置透明（透明出下边的背景图）"></a>background-clip 可以给文字设置透明（透明出下边的背景图）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.test &#123;</span><br><span class="line">        position: relative;</span><br><span class="line">        width: 500px;</span><br><span class="line">        height: 600px;</span><br><span class="line">        background: linear-gradient(60deg, red, yellow, red, yellow, red);</span><br><span class="line">        font-weight: bold;</span><br><span class="line">        font-size: 50px;</span><br><span class="line">        background-clip: text;</span><br><span class="line">        -webkit-background-clip: text;</span><br><span class="line">        color: rgba(0,0,0,.2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> &lt;div class&#x3D;&quot;test&quot;&gt;</span><br><span class="line">        我是文字</span><br><span class="line"> &lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="webkit-text-stroke-设置文字描边"><a href="#webkit-text-stroke-设置文字描边" class="headerlink" title="-webkit-text-stroke 设置文字描边"></a>-webkit-text-stroke 设置文字描边</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.miaobian &#123;</span><br><span class="line">    -webkit-text-stroke: 2px red;   </span><br><span class="line">        font-size: 50px;</span><br><span class="line">        color: #fff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;p class&#x3D;&quot;miaobian &quot;&gt;这个文字有描边&lt;&#x2F;p&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="使用浏览器原生的dialog"><a href="#使用浏览器原生的dialog" class="headerlink" title="使用浏览器原生的dialog"></a>使用浏览器原生的dialog</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;button id&#x3D;&quot;popBtn&quot;&gt;弹窗&lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- &lt;form&gt; 元素可关闭含有属性 method&#x3D;&quot;dialog&quot; 的对话框。当提交表单时，对话框的 returnValue (en-US) 属性将会等于表单中被使用的提交按钮的 value --&gt;</span><br><span class="line">&lt;dialog id&#x3D;&quot;favDialog&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;pop&quot;&gt;</span><br><span class="line">        &lt;form method&#x3D;&quot;dialog&quot;&gt;     </span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;label for&#x3D;&quot;&quot;&gt;输入&lt;input type&#x3D;&quot;text&quot;&gt;&lt;&#x2F;label&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;label&gt;Favorite animal:</span><br><span class="line">                    &lt;select&gt;</span><br><span class="line">                    &lt;option value&#x3D;&quot;default&quot;&gt;Choose…&lt;&#x2F;option&gt;</span><br><span class="line">                    &lt;option&gt;Brine shrimp&lt;&#x2F;option&gt;                        </span><br><span class="line">                    &lt;&#x2F;select&gt;</span><br><span class="line">                &lt;&#x2F;label&gt;          </span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">            &lt;button id&#x3D;&quot;confirmBtn&quot;&gt;OK&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;!-- 不写这个favDialog.close()点取消按钮也能关闭弹窗 因为按钮在form里 --&gt;</span><br><span class="line">            &lt;button id&#x3D;&quot;cancel&quot; onclick&#x3D;&quot;favDialog.close()&quot;&gt;取消&lt;&#x2F;button&gt;     </span><br><span class="line">        &lt;&#x2F;form&gt;          </span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;dialog&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    var popBtn &#x3D; document.querySelector(&quot;#popBtn&quot;);</span><br><span class="line">    const favDialog &#x3D; document.getElementById(&#39;favDialog&#39;);</span><br><span class="line">    const confirmBtn &#x3D; document.getElementById(&quot;confirmBtn&quot;)</span><br><span class="line">    const cancelBtn &#x3D; document.getElementById(&quot;cancel&quot;);</span><br><span class="line"></span><br><span class="line">    if(typeof favDialog.showModal !&#x3D;&#x3D; &#39;function&#39;) &#123;</span><br><span class="line">        console.log(&#39;不支持dialog&#39;)</span><br><span class="line">    &#125;</span><br><span class="line">    popBtn.addEventListener(&quot;click&quot;,()&#x3D;&gt;&#123;</span><br><span class="line">        favDialog.showModal()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    favDialog.addEventListener(&#39;close&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">        console.log(&#39;监听到弹窗关闭&#39;,favDialog.returnValue)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="图片-气泡框添加阴影"><a href="#图片-气泡框添加阴影" class="headerlink" title="图片/气泡框添加阴影"></a>图片/气泡框添加阴影</h3><ul>
<li>如果图片是SVG，并且不是矩形的（如示列中的火狐LOGO），我们添加阴影(box-shadow)的时候会是一个矩形的框，不是我们想要的</li>
<li>如果你做了一个气泡DIV，他的小箭头 和整体要求一个阴影，但是你使用 box-shadow  也会达不到预期</li>
<li>使用<code>filter: drop-shadow(里边的属性和box-shadow一致);</code>可以解决此类问题</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">html:</span><br><span class="line"></span><br><span class="line">图片：</span><br><span class="line">&lt;img class&#x3D;&quot;shadow_img&quot; src&#x3D;&quot;http:&#x2F;&#x2F;www.firefox.com.cn&#x2F;media&#x2F;protocol&#x2F;img&#x2F;logos&#x2F;firefox&#x2F;browser&#x2F;logo-word-hor.7ff44b5b4194.svg&quot; alt&#x3D;&quot;&quot;&gt;</span><br><span class="line"></span><br><span class="line">气泡框：</span><br><span class="line">&lt;div class&#x3D;&quot;bubble&quot;&gt;</span><br><span class="line">       气泡框</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">css:</span><br><span class="line"></span><br><span class="line">.shadow_img &#123;</span><br><span class="line">            filter: drop-shadow(0 0 15px #000);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">.bubble &#123;</span><br><span class="line">    width: 300px;</span><br><span class="line">    height: 200px;</span><br><span class="line">    margin-left: 30px;</span><br><span class="line">    position: relative;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    padding: 10px;</span><br><span class="line">    background-color: #ccc;</span><br><span class="line">    border-radius: 6px;</span><br><span class="line">    filter: drop-shadow(0 0 15px #000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.bubble::before &#123;</span><br><span class="line">    content: &quot;&quot;;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 50%;</span><br><span class="line">    left:-30px;</span><br><span class="line">    transform: translateY(-50%);</span><br><span class="line">    border-width: 18px;</span><br><span class="line">    border-style: solid;</span><br><span class="line">    border-color: transparent #ccc  transparent transparent </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="保持元素宽高比-aspect-ratio-vs-传统方案"><a href="#保持元素宽高比-aspect-ratio-vs-传统方案" class="headerlink" title="保持元素宽高比 aspect-ratio vs 传统方案"></a>保持元素宽高比 aspect-ratio vs 传统方案</h3><ul>
<li>假射有一个DIV，我们需要保持他的宽高比是4：3，用新的API aspect-ratio 可以很方便的做到这点</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;aspect-ratio-div&quot;&gt;</span><br><span class="line">       保持元素宽高比一直是4:3</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">.aspect-ratio-div &#123;</span><br><span class="line">   background-color: #000;</span><br><span class="line">   width: 40%;</span><br><span class="line">   margin: 0 auto;</span><br><span class="line">   &#x2F;*兼容性一般*&#x2F;</span><br><span class="line">   aspect-ratio: 4 &#x2F; 3; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>传统方案 使用padding</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;aspect-ratio-div&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;inner&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;content&quot;&gt;这个最内部的DIV里再写元素，因为父级的DIV高度是0，是靠padding撑开的&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.aspect-ratio-div &#123;</span><br><span class="line">    background-color: #ccc;</span><br><span class="line">    width: 40%;</span><br><span class="line">    margin: 0 auto;</span><br><span class="line">&#125;</span><br><span class="line">.aspect-ratio-div .inner &#123;</span><br><span class="line">    background-color: #000;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 0;</span><br><span class="line">    &#x2F;*这个子元素的高度要是父元素宽度的 3&#x2F;4*&#x2F;</span><br><span class="line">    &#x2F;*padding 设置的百分比是相对于父元素的*&#x2F;</span><br><span class="line">    padding-bottom: 75%;</span><br><span class="line">    color: #fff;</span><br><span class="line">    position: relative;</span><br><span class="line">&#125;</span><br><span class="line">.aspect-ratio-div .inner .content &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    inset: 0; &#x2F;*代表 top:0,left:0,bottom:0,right:0*&#x2F;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="旋转边框"><a href="#旋转边框" class="headerlink" title="旋转边框"></a>旋转边框</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">.rotateBorder &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    outline: 4px solid #000;</span><br><span class="line">    width: 200px;</span><br><span class="line">    height: 150px;</span><br><span class="line">    margin-left: 50px;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">    padding: 10px;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#x2F;*在他内部设置一个DIV，宽高超过父元素，一直旋转*&#x2F;</span><br><span class="line">.rotateBorder::before&#123;</span><br><span class="line">    content: &quot;&quot;;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 200%;</span><br><span class="line">    height: 200%;</span><br><span class="line">    background-color: #f40;</span><br><span class="line">    z-index: -1; &#x2F;*让他不要挡住内容*&#x2F;</span><br><span class="line">    left: 50%;</span><br><span class="line">    top: 50%;</span><br><span class="line">    transform-origin: 0 0; &#x2F;*设置旋转中心点在中间*&#x2F;</span><br><span class="line">    animation: rotate 3s linear infinite;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;*再设置一个DIV，挡住旋转DIV的中间大部分，就留着旋转DIV的边部分能看到*&#x2F;</span><br><span class="line">.rotateBorder::after &#123;</span><br><span class="line">content: &#39;&#39;;</span><br><span class="line">position: absolute;</span><br><span class="line">width: calc(100% - 20px);</span><br><span class="line">height: calc(100% - 20px);</span><br><span class="line">&#x2F;* background-color: #ccc; *&#x2F;</span><br><span class="line">left: 10px;</span><br><span class="line">top: 10px;</span><br><span class="line">background-color: #fff;</span><br><span class="line">z-index: -1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes rotate &#123;</span><br><span class="line">    to &#123;</span><br><span class="line">    transform: rotate(1turn); &#x2F;*旋转1圈*&#x2F;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &lt;div class&#x3D;&quot;rotateBorder&quot;&gt;</span><br><span class="line">        旋转边框</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="使用compositionstart来解决中文输入法-实时搜索的问题"><a href="#使用compositionstart来解决中文输入法-实时搜索的问题" class="headerlink" title="使用compositionstart来解决中文输入法 实时搜索的问题"></a>使用<code>compositionstart</code>来解决中文输入法 实时搜索的问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">const inp &#x3D; document.querySelector(&#39;input&#39;);</span><br><span class="line">let isComposing &#x3D; false; &#x2F;&#x2F;是否正在合成</span><br><span class="line"></span><br><span class="line">function search() &#123;</span><br><span class="line">    if(isComposing) return ;</span><br><span class="line">    console.log(inp.value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">inp.addEventListener(&#39;input&#39;, function()&#123;</span><br><span class="line">    search()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">inp.addEventListener(&#39;compositionstart&#39;, function()&#123;</span><br><span class="line">    isComposing &#x3D; true;</span><br><span class="line">    console.log(&#39;输入开始&#39;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">inp.addEventListener(&#39;compositionend&#39;, function()&#123;</span><br><span class="line">    isComposing &#x3D; false;</span><br><span class="line">    search()</span><br><span class="line">    console.log(&#39;输入结束&#39;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="渡一大师课"><a href="#渡一大师课" class="headerlink" title="渡一大师课"></a>渡一大师课</h1><h3 id="浏览器进程，线程"><a href="#浏览器进程，线程" class="headerlink" title="浏览器进程，线程"></a>浏览器进程，线程</h3><ul>
<li>一个进程就是开辟了一块内存空间，一个线程就是内存空间有一个干活的人。</li>
<li>浏览器有可以有多个线程，多个进程。</li>
<li>当前谷歌浏览器，每个TAB就是一个进程，防止互相影响。其中一个TAB崩坏也不会影响其他的</li>
</ul>
<h3 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h3><ul>
<li>过去把消息队列分为宏队列和微队列，现在则根据不同的任务队列（主线程，微队列，延迟队列，交互队列等）分为多个队列，同类型任务在相同的队列，<br>微队列有最高的优先级，主线程任务完成后优先调度微队列的任务（Promise.reslove().then(fn)直接放入微队列）</li>
</ul>
<h3 id="为什么使用transform做动画效率高"><a href="#为什么使用transform做动画效率高" class="headerlink" title="为什么使用transform做动画效率高"></a>为什么使用transform做动画效率高</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@keyframes move1 &#123;</span><br><span class="line">    to &#123;</span><br><span class="line">        transform:translate(100px)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes move2 &#123;</span><br><span class="line">    to &#123;</span><br><span class="line">        left : 100px</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>动画都是偏移100PX  使用left 会引起重排（reflow） ,会占用浏览器的主线程,使用transform 不占用主线程 ，页面卡死也不会受影响。</li>
</ul>
<h3 id="处理并发请求，给你100个请求连接，每次只能同时发送3个请求，都发送完成后，返回一个结果-，里边是所有发送成功或者失败的结果"><a href="#处理并发请求，给你100个请求连接，每次只能同时发送3个请求，都发送完成后，返回一个结果-，里边是所有发送成功或者失败的结果" class="headerlink" title="处理并发请求，给你100个请求连接，每次只能同时发送3个请求，都发送完成后，返回一个结果[]，里边是所有发送成功或者失败的结果"></a>处理并发请求，给你100个请求连接，每次只能同时发送3个请求，都发送完成后，返回一个结果[]，里边是所有发送成功或者失败的结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 处理并发请求，控制最大并发请求数，</span><br><span class="line"> * @param &#123;string[]&#125; urls 待请求的URLS 数组 </span><br><span class="line"> * @param &#123;*&#125; maxNum  最大并发请求数</span><br><span class="line"> * @returns &#123;Promise[]&#125; Promise数组 每个Promise对应一个URL的返回结果(正确或者错误都要)，顺序要按照urls数组顺序</span><br><span class="line"> *&#x2F;</span><br><span class="line">function concurRequest(urls,maxNum) &#123;</span><br><span class="line">    return new Promise(resolve&#x3D;&gt;&#123;</span><br><span class="line"></span><br><span class="line">        if(urls.length &#x3D;&#x3D; 0) &#123;</span><br><span class="line">            resolve([])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        let index &#x3D; 0; &#x2F;&#x2F;下一次请求的URL地址,在URLS数组中对应的下标</span><br><span class="line">        let count &#x3D; 0; &#x2F;&#x2F;请求完成的数量，这里不能使用index表示请求完成的数量，因为index只代表发送了多少次请求，不能代表完成了几次；</span><br><span class="line">        const result &#x3D; [];</span><br><span class="line">        async function request() &#123;</span><br><span class="line">            const i &#x3D; index; &#x2F;&#x2F;保存原数组的下标，为了放到result[]的相应位置中</span><br><span class="line">           </span><br><span class="line">            const url &#x3D; urls[index];</span><br><span class="line">            index++;</span><br><span class="line">            try&#123;</span><br><span class="line">                &#x2F;&#x2F;每次请求的返回结果 </span><br><span class="line">                const resp &#x3D; await fetch(url);</span><br><span class="line">                result[i] &#x3D; resp</span><br><span class="line"></span><br><span class="line">            &#125;catch(err)&#123;</span><br><span class="line">                result[i] &#x3D; err;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            finally&#123;</span><br><span class="line">                count++;</span><br><span class="line">                console.log(count,urls.length)</span><br><span class="line">                if(count &#x3D;&#x3D; urls.length) &#123;</span><br><span class="line">                    console.log(&#39;全部请求完成！&#39;)</span><br><span class="line">                    &#x2F;&#x2F;全部请求完成</span><br><span class="line">                    resolve(result);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                &#x2F;&#x2F;每次无论成功还是失败 运行完都要继续调用request()</span><br><span class="line">                if(index &lt; urls.length) &#123;</span><br><span class="line">                    request();</span><br><span class="line">                &#125;</span><br><span class="line">               </span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for (let i&#x3D;0; i&lt;Math.min(maxNum,urls.length); i++) &#123;</span><br><span class="line">            request();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;使用</span><br><span class="line"></span><br><span class="line">var urls &#x3D;  []</span><br><span class="line">for (let i&#x3D;1; i&lt;&#x3D;20; i++) &#123;</span><br><span class="line">    urls.push(&#96;https:&#x2F;&#x2F;jsonplaceholder.typicode.com&#x2F;todos&#x2F;$&#123;i&#125;&#96;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">concurRequest(urls,3).then(resps&#x3D;&gt;&#123;</span><br><span class="line">    console.log(resps)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="使用compositionstart来解决中文输入法-实时搜索的问题-1"><a href="#使用compositionstart来解决中文输入法-实时搜索的问题-1" class="headerlink" title="使用compositionstart来解决中文输入法 实时搜索的问题"></a>使用<code>compositionstart</code>来解决中文输入法 实时搜索的问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">const inp &#x3D; document.querySelector(&#39;input&#39;);</span><br><span class="line">let isComposing &#x3D; false; &#x2F;&#x2F;是否正在合成</span><br><span class="line"></span><br><span class="line">function search() &#123;</span><br><span class="line">    if(isComposing) return ;</span><br><span class="line">    console.log(inp.value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">inp.addEventListener(&#39;input&#39;, function()&#123;</span><br><span class="line">    search()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">inp.addEventListener(&#39;compositionstart&#39;, function()&#123;</span><br><span class="line">    isComposing &#x3D; true;</span><br><span class="line">    console.log(&#39;输入开始&#39;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">inp.addEventListener(&#39;compositionend&#39;, function()&#123;</span><br><span class="line">    isComposing &#x3D; false;</span><br><span class="line">    search()</span><br><span class="line">    console.log(&#39;输入结束&#39;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="限制请求重试次数"><a href="#限制请求重试次数" class="headerlink" title="限制请求重试次数"></a>限制请求重试次数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 限制一个请求，如果请求失败的最大尝试次数</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">function request(url,maxCount &#x3D; 5) &#123;</span><br><span class="line">  return fetch(url).then(res &#x3D;&gt; &#123;</span><br><span class="line">      console.log(res)</span><br><span class="line">  &#125;).catch(err &#x3D;&gt; &#123;</span><br><span class="line">    if (maxCount &gt; 0) &#123;</span><br><span class="line">      return request(url,maxCount - 1)</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">      return Promise.reject(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">request(&#39;https:&#x2F;&#x2F;adfaf.com&#x2F;todos1&#39;).then(res &#x3D;&gt; &#123;</span><br><span class="line">  </span><br><span class="line">&#125;).catch(err &#x3D;&gt; &#123;</span><br><span class="line">  console.log(err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="使用AbortController-来取消上一次请求"><a href="#使用AbortController-来取消上一次请求" class="headerlink" title="使用AbortController 来取消上一次请求"></a>使用AbortController 来取消上一次请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 使用AbortController 来取消上一次请求，可用在输入框连续快速输入文字时候，每次输入都会取消上一次的请求，</span><br><span class="line"> * 防止请求过多，且避免返回的数据顺序错乱</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">let controller ;</span><br><span class="line">input.onInput &#x3D; async () &#x3D;&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F; 用AbortController 来取消上一次请求</span><br><span class="line">    if (controller) &#123;</span><br><span class="line">        controller.abort();</span><br><span class="line">    &#125;</span><br><span class="line">    controller &#x3D; new AbortController();</span><br><span class="line">    await fetch(&#39;https:&#x2F;&#x2F;www.baidu.com&#39; + input.value, &#123; signal: controller.signal &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="vite-配置打包项目目录"><a href="#vite-配置打包项目目录" class="headerlink" title="vite 配置打包项目目录"></a>vite 配置打包项目目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">export default defineConfig(&#123;</span><br><span class="line">  plugins: [vue()],</span><br><span class="line">  </span><br><span class="line">  build: &#123;</span><br><span class="line">    rollupOptions: &#123;</span><br><span class="line">      output: &#123;</span><br><span class="line">        &#x2F;&#x2F;引入的文件放到JS下</span><br><span class="line">        entryFileNames:&#39;js&#x2F;[name].js&#39;,</span><br><span class="line">        &#x2F;&#x2F;import 这种分包的也放到JS下</span><br><span class="line">        chunkFileNames:&#39;js&#x2F;[name].js&#39;,</span><br><span class="line">        &#x2F;&#x2F;其他文件。包含CSS等根据自己的名字来</span><br><span class="line">        assetFileNames(assetInfo) &#123;</span><br><span class="line">          if(assetInfo.name.endsWith(&#39;.css&#39;)) &#123;</span><br><span class="line">            return &#39;css&#x2F;[name].[ext]&#39;</span><br><span class="line">          &#125;</span><br><span class="line">          if([&#39;.png&#39;,&#39;.jpg&#39;,&#39;.jpeg&#39;,&#39;.gif&#39;,&#39;.svg&#39;,&#39;.webp&#39;].some(ext&#x3D;&gt;assetInfo.name.endsWith(ext))) &#123;</span><br><span class="line">            return &#39;images&#x2F;[name].[ext]&#39;</span><br><span class="line">            </span><br><span class="line">          &#125;</span><br><span class="line">          &#x2F;&#x2F;其余的资源</span><br><span class="line">          return &#39;assets&#x2F;[name].[ext]&#39;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/31/miniProgram/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=558582640,2047403197&fm=27&gp=0.jpg">
      <meta itemprop="name" content="魏彬">
      <meta itemprop="description" content="很乱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/31/miniProgram/" class="post-title-link" itemprop="url">小程序一些问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-31 14:13:23" itemprop="dateCreated datePublished" datetime="2022-08-31T14:13:23+08:00">2022-08-31</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-09-05 11:32:51" itemprop="dateModified" datetime="2022-09-05T11:32:51+08:00">2022-09-05</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" itemprop="url" rel="index"><span itemprop="name">小程序</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="github-地址"><a href="#github-地址" class="headerlink" title="github 地址"></a>github 地址</h3><p><a target="_blank" rel="noopener" href="https://github.com/weibsgz/miniProgram">https://github.com/weibsgz/miniProgram</a></p>
<ol>
<li>关于WXS</li>
</ol>
<ul>
<li>小程序的运行环境分成渲染层和逻辑层，其中 WXML 模板和 WXSS 样式工作在渲染层，JS 脚本工作在逻辑层。响应的数据绑定系统通过this.setData()在两者之间进行数据传输。有频繁用户交互的效果在小程序上表现是比较卡顿的。比如你在bind:touchmove事件中去不停的setData试图改变一个节点的位置，这是行不通的，太卡了。</li>
<li>基于以上情况，微信小程序的设计者就提出了wxs的概念。 WXS 直接在渲染层做通信 性能消耗低</li>
<li>WXS 不依赖于运行时的基础库版本，可以在所有版本的小程序中运行</li>
<li>WXS 的运行环境和其他 JavaScript 代码是隔离的，WXS 中不能调用其他 JavaScript 文件中定义的函数，也不能调用小程序提供的API。</li>
<li>WXS只能使用 JavaScript 的 ES5 语法</li>
<li>本项目中 components/tabs  中首页滑动内容区域执行wxs的 touchstart touchend方法。</li>
<li>wxs也可以做数据格式化处理 /common/wxs/status-text.wxs</li>
</ul>
<ol start="2">
<li>如果多个页面都要用到的公共组件 可以放到app.json中声明</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;usingComponents&quot;: &#123;</span><br><span class="line">  &quot;c-icon&quot; : &quot;&#x2F;components&#x2F;icon&#x2F;icon&quot;,</span><br><span class="line">  &quot;c-tabs&quot;:&quot;&#x2F;components&#x2F;tabs&#x2F;tabs&quot;,</span><br><span class="line">  &quot;c-service-preivew&quot; : &quot;&#x2F;components&#x2F;service-preview&#x2F;service-preview&quot;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>下拉刷新，需要在目标页JSON或者全局app.json中配置enablePullDownRefresh,默认加载中的样式是白色的，需要在app.json中修改backgroundTextStyle</li>
</ol>
<ol start="4">
<li>IOS手机 <ul>
<li>底部橡皮筋白色 通过在app.json中设置 backgroundColorBottom为你的背景色解决</li>
<li>顶部橡皮筋白色 通过在业务页面的JSON中设置 backgroundColorTop解决</li>
</ul>
</li>
</ol>
<ol start="5">
<li>position: sticky吸顶效果  如果他的父元素是 height:100%  那么他滚动到100%高度的时候就无效了 ，需要把父元素设置为 min-height:100%</li>
</ol>
<ul>
<li>fixed 生成固定定位的元素，相对于浏览器窗口进行定位。元素的位置通过 “left”, “top”, “right” 以及 “bottom” 属性进行规定。<br>sticky 粘性定位，该定位基于用户滚动的位置。它的行为就像 position:relative; 而当页面滚动超出目标区域时，它的表现就像 position:fixed;，它会固定在目标位置。</li>
</ul>
<ol start="6">
<li>safe-area  只有IOS10以上才有底部一个黑条 他所在的区域就是安全区域，我们的业务内容需要避开这个区域</li>
</ol>
<p><code>components/safe-area/safe-area.wxss</code> 中是处理安全区域的组件  使用不同的边距样式</p>
<ol start="7">
<li>外部样式类</li>
</ol>
<ul>
<li>组件JS中加入配置 <code>  externalClasses: [ &#39;i-button-class&#39;, &#39;i-button-special-class&#39; ],</code></li>
<li>组件WXML中 <code>&lt;view wx:if=&quot;&#123;&#123;!special&#125;&#125;&quot;class=&quot;i-button i-button-class&gt;</code></li>
<li>父组件 <code>&lt;c-button i-button-class=&quot;my-i-button-class&quot;&gt;</code></li>
<li>父组件 wxss <code>.my-i-button-class &#123;color: red !important;&#125;</code></li>
</ul>
<ol start="8">
<li>引入 WEUI</li>
</ol>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/platform-capabilities/extended/weui/">https://developers.weixin.qq.com/miniprogram/dev/platform-capabilities/extended/weui/</a></p>
</li>
<li><p>app.json中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  &#x2F;&#x2F;mp-msg是某个组件</span><br><span class="line"></span><br><span class="line">  &quot;usingComponents&quot;: &#123;    </span><br><span class="line">    &quot;mp-msg&quot;:&quot;weui-miniprogram&#x2F;msg&#x2F;msg&quot;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;useExtendedLib&quot;: &#123;</span><br><span class="line">    &quot;weui&quot;:true</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="9">
<li>引入TIM SDK </li>
</ol>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/269/37411">https://cloud.tencent.com/document/product/269/37411</a><br><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/tim-wx-sdk">https://www.npmjs.com/package/tim-wx-sdk</a></p>
<ul>
<li>在小程序目录下     node.js &gt; v12<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">npm install tim-wx-sdk --save</span><br><span class="line">npm install tim-upload-plugin --save</span><br></pre></td></tr></table></figure></li>
<li>小程序编辑器中 开发者工具菜单——工具——构建 npm</li>
</ul>
<ul>
<li><a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/">https://console.cloud.tencent.com/</a> 注册账号 在搜索中搜索IM 在IM控制台创建项目 获取SDKAPPID </li>
</ul>
<p><code>model/tim.js</code> 中初始化TIM</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import TIM from &#39;tim-wx-sdk&#39;;</span><br><span class="line">import TIMUploadPlugin from &#39;tim-upload-plugin&#39;;</span><br><span class="line"></span><br><span class="line">let options &#x3D; &#123;</span><br><span class="line">  SDKAppID: 你申请的SDKAPPID &#x2F;&#x2F; 接入时需要将 0 替换为您的云通信应用的 SDKAppID，类型为 Number</span><br><span class="line">&#125;;</span><br><span class="line">&#x2F;&#x2F; 创建 SDK 实例，&#96;TIM.create()&#96;方法对于同一个 &#96;SDKAppID&#96; 只会返回同一份实例</span><br><span class="line">let tim &#x3D; TIM.create(options); &#x2F;&#x2F; SDK 实例通常用 tim 表示</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 设置 SDK 日志输出级别，详细分级请参见 setLogLevel 接口的说明</span><br><span class="line">tim.setLogLevel(0); &#x2F;&#x2F; 普通级别，日志量较多，接入时建议使用</span><br><span class="line">&#x2F;&#x2F; tim.setLogLevel(1); &#x2F;&#x2F; release级别，SDK 输出关键信息，生产环境时建议使用</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 注册腾讯云即时通信 IM 上传插件</span><br><span class="line">tim.registerPlugin(&#123;&#39;tim-upload-plugin&#39;: TIMUploadPlugin&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 接下来可以通过 tim 进行事件绑定和构建 IM 应用</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>项目中使用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import Tim from &#39;..&#x2F;..&#x2F;model&#x2F;tim&#39;</span><br><span class="line"></span><br><span class="line">new Tim()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><p>看到IDE的控制台打印出TIM的信息 代表引入成功</p>
</li>
<li><p>userSig生成 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/im/detail">https://console.cloud.tencent.com/im/detail</a></p>
</li>
<li><p>用sdkAppid 和 密钥生成签名 本项目中前端生成签名 （开发阶段）实际使用时候必须后端生成签名</p>
</li>
<li><p>前端生成签名方法：</p>
</li>
<li><p><code>libs/tim/两个文件</code></p>
</li>
<li><p>generate-test-usersig.js 里 配置你的 用sdkAppid和密钥</p>
</li>
</ul>
<ol start="10">
<li>安装MBOX</li>
</ol>
<ul>
<li><p>package.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 配置以下这两个依赖信息</span><br><span class="line">&quot;mobx-miniprogram&quot;: &quot;4.13.2&quot;,</span><br><span class="line">&quot;mobx-miniprogram-bindings&quot;: &quot;2.0.0&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>构建NPM</p>
</li>
<li><p><code>/store/tim.js</code> 配置文件</p>
</li>
<li><p>page中调用   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import &#123; createStoreBindings &#125; from &quot;mobx-miniprogram-bindings&quot;;</span><br><span class="line">import &#123; timStore &#125; from &quot;..&#x2F;..&#x2F;store&#x2F;tim&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> onLoad: function (options) &#123;</span><br><span class="line">   &#x2F;**  mbox调用</span><br><span class="line">   * this 当前页面的this</span><br><span class="line">   * store </span><br><span class="line">   * fields &#x2F;&#x2F;使用store 中哪个state</span><br><span class="line">   * actiion  &#x2F;&#x2F;store中用哪个action</span><br><span class="line">   * </span><br><span class="line">   * 配置好后 createStoreBindings 就可以把我们在store中配置的状态绑定到我们当前page对象下</span><br><span class="line">   *&#x2F;</span><br><span class="line"></span><br><span class="line">    this.storeBindings &#x3D; createStoreBindings(this, &#123;</span><br><span class="line">      store: timStore,</span><br><span class="line">      fields: [&#39;sdkReady&#39;],</span><br><span class="line">      actions: [&#39;login&#39;]</span><br><span class="line">    &#125;)</span><br><span class="line">    &#x2F;&#x2F;当前页面的this直接可以调用store的方法了</span><br><span class="line">    &#x2F;&#x2F; this.data.sdkReady 也会有值  页面中可以使用&#123;&#123;sdkReady&#125;&#125;</span><br><span class="line">    this.login()</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;页面销毁时候同时 销毁STORE的绑定</span><br><span class="line"> onUnload: function () &#123;</span><br><span class="line">    this.storeBindings.destroyStoreBindings()</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
<li><p>js中使用同样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStoreBindings &#125; from &quot;mobx-miniprogram-bindings&quot;;</span><br><span class="line">import &#123; timStore &#125; from &quot;..&#x2F;store&#x2F;tim&quot;;</span><br><span class="line"></span><br><span class="line">this.storeBindings &#x3D; createStoreBindings(this, &#123;</span><br><span class="line">    store: timStore,</span><br><span class="line">    fields: [&#39;sdkReady&#39;],</span><br><span class="line">    actions: &#123; timLogout: &#39;logout&#39; &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"> if (this.sdkReady) &#123;</span><br><span class="line">        this.timLogout()</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>在自定义组件中使用 用behaviors </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import &#123; storeBindingsBehavior &#125; from &quot;mobx-miniprogram-bindings&quot;;</span><br><span class="line">import &#123; timStore &#125; from &quot;..&#x2F;..&#x2F;..&#x2F;..&#x2F;store&#x2F;tim&quot;;</span><br><span class="line"></span><br><span class="line">Component(&#123;</span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 组件的属性列表</span><br><span class="line">   *&#x2F;</span><br><span class="line">  behaviors:[storeBindingsBehavior],</span><br><span class="line">  storeBindings:&#123;</span><br><span class="line">    store:timStore,</span><br><span class="line">    fields:[&#39;messageList&#39;],</span><br><span class="line">    actions:[&#39;getMessageList&#39;,&#39;setTargetUserId&#39;]</span><br><span class="line">  &#125;,</span><br><span class="line">  properties: &#123;</span><br><span class="line">      </span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 组件的初始数据</span><br><span class="line">   *&#x2F;</span><br><span class="line">  data: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 组件的方法列表</span><br><span class="line">   *&#x2F;</span><br><span class="line">  methods: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ol start="11">
<li>本项目为了测试聊天  需要 下载的腾讯小程序IM DEMO  在里边创建了一个用户weibsgz 输入我们当前这个项目的userId(微信授权登录后是2573) 和 2573聊天 在conversation中可以看到聊天</li>
</ol>
<ul>
<li><p>model/tim.js login方法里边可以知道我们的微信登录后获取接口给我们设置的用户ID （2573）</p>
</li>
<li><p>在<code>conversation.js</code>中设置目标聊天人(weibsgz) 和本项目中登录的用户和weibsgz的聊天列表<br><code>this.setTargetUserId(&#39;weibsgz&#39;)</code></p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/27/css-animation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=558582640,2047403197&fm=27&gp=0.jpg">
      <meta itemprop="name" content="魏彬">
      <meta itemprop="description" content="很乱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/27/css-animation/" class="post-title-link" itemprop="url">css动画小栗子</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-07-27 14:13:23 / Modified: 16:16:10" itemprop="dateCreated datePublished" datetime="2022-07-27T14:13:23+08:00">2022-07-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/css/" itemprop="url" rel="index"><span itemprop="name">css</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="requestAnimationFrame-和-定时器执行动画比较"><a href="#requestAnimationFrame-和-定时器执行动画比较" class="headerlink" title="requestAnimationFrame 和 定时器执行动画比较"></a>requestAnimationFrame 和 定时器执行动画比较</h3><ul>
<li>requestAnimationFrame 会把每一帧中的所有 DOM 操作集中起来，在一次重绘或回流中就完成，使动画和浏览器刷新频率保持一致 保持动画流畅</li>
<li>当页面处理未激活的状态下，requestAnimationFrame将不进行重绘回流 节省CPU GPU</li>
<li>settimeout 任务被放入异步队列，只有当主线程任务执行完后才会执行队列中的任务，因此实际执行时间总是比设定时间要晚；</li>
<li>settimeout 的固定时间间隔不一定与屏幕刷新间隔时间相同，会引起丢帧。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .moveDiv,.moveDiv1&#123;</span><br><span class="line">            position: relative;</span><br><span class="line">            width: 50px;</span><br><span class="line">            height: 50px;</span><br><span class="line">            background-color:red;</span><br><span class="line">        &#125;</span><br><span class="line">        .moveDiv1 &#123;</span><br><span class="line">            background-color:blue;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;&#x2F;style&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;!-- 定时器和 requestAnimationFrame --&gt;    </span><br><span class="line">    &lt;button id&#x3D;&quot;button1&quot;&gt;setTimeout&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;button id&#x3D;&quot;button2&quot;&gt;requestAnimationFrame&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;moveDiv&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;moveDiv1&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;script&gt;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; &#x2F;&#x2F; requestAnimationFrame 和 定时器执行动画比较</span><br><span class="line">        &#x2F;&#x2F; &#x2F;&#x2F; requestAnimationFrame 会把每一帧中的所有 DOM 操作集中起来，在一次重绘或回流中就完成，使动画和浏览器刷新频率保持一致 保持动画流畅</span><br><span class="line">        &#x2F;&#x2F; &#x2F;&#x2F;当页面处理未激活的状态下，requestAnimationFrame将不进行重绘回流 节省CPU GPU</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; settimeout 任务被放入异步队列，只有当主线程任务执行完后才会执行队列中的任务，因此实际执行时间总是比设定时间要晚；</span><br><span class="line">        &#x2F;&#x2F; settimeout 的固定时间间隔不一定与屏幕刷新间隔时间相同，会引起丢帧。</span><br><span class="line"></span><br><span class="line">        var btn1 &#x3D; document.querySelector(&quot;#button1&quot;)</span><br><span class="line">        var btn2 &#x3D; document.querySelector(&quot;#button2&quot;)</span><br><span class="line">        var moveObj &#x3D; document.querySelector(&quot;.moveDiv&quot;)</span><br><span class="line">        var moveObj1 &#x3D; document.querySelector(&quot;.moveDiv1&quot;)</span><br><span class="line">        var timer &#x3D; null;</span><br><span class="line">        var timer1 &#x3D; null;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;setInterval执行动画</span><br><span class="line">        btn1.onclick &#x3D; function() &#123;</span><br><span class="line">            var count &#x3D; 0;</span><br><span class="line">            if(timer)  &#123;</span><br><span class="line">                &#x2F;&#x2F; clearInterval(timer)</span><br><span class="line">                return false</span><br><span class="line">            &#125;</span><br><span class="line">            timer &#x3D; setInterval(function()&#123;</span><br><span class="line">                go(count)</span><br><span class="line">                count++;</span><br><span class="line">                if(count &gt; 1000 ) clearInterval(timer)</span><br><span class="line">            &#125;,10)            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        function go(count) &#123;</span><br><span class="line">            moveObj.style.transform &#x3D; &#39;translatex(&#39; + count + &#39;px)&#39;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;  requestAnimationFrame 执行动画        </span><br><span class="line">        var count1 &#x3D; 0;</span><br><span class="line">        btn2.onclick &#x3D; function() &#123;      </span><br><span class="line">            window.cancelAnimationFrame(timer1)      </span><br><span class="line">            timer1 &#x3D; window.requestAnimationFrame(go1)       </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function go1() &#123;</span><br><span class="line">            </span><br><span class="line">            if(count1&lt;1000) &#123;</span><br><span class="line">                moveObj1.style.transform &#x3D; &#39;translatex(&#39; + count1 + &#39;px)&#39;</span><br><span class="line">                count1++;</span><br><span class="line">                timer1 &#x3D; window.requestAnimationFrame(go1) </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="animation-小动画"><a href="#animation-小动画" class="headerlink" title="animation 小动画"></a>animation 小动画</h3><ul>
<li><code>animation-play-state</code> 属性指定动画是否正在运行或已暂停。可以在CSS和JS中设置</li>
<li>webkitAnimationStart-动画开始，webkitAnimationEnd-动画结束，webkitAnimationIteration-动画重复播放 ，即可以很方便的监听动画过程<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;style&gt;       </span><br><span class="line"></span><br><span class="line">        .warp &#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 300px;</span><br><span class="line">            border: 1px solid #F60093;</span><br><span class="line">            overflow: hidden;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .progress-in &#123;</span><br><span class="line">            position: relative;</span><br><span class="line">            width: 100%;</span><br><span class="line">            height: 100%;</span><br><span class="line">            background: red;</span><br><span class="line">            opacity: 1;</span><br><span class="line">            transform: translateY(100%);</span><br><span class="line">            animation: 3s linear 0s progress forwards;</span><br><span class="line">            &#x2F;* 动画初始状态 暂停 *&#x2F;</span><br><span class="line">            animation-play-state:paused;   </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @keyframes progress &#123;</span><br><span class="line">            from &#123;</span><br><span class="line">                transform: translateY(100%);</span><br><span class="line">            &#125;</span><br><span class="line">            to &#123;</span><br><span class="line">                transform: translateY(0);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #start &#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 30px;</span><br><span class="line">            left: 200px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;&#x2F;style&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;  </span><br><span class="line">  </span><br><span class="line">     &lt;div class&#x3D;&quot;warp&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;progress-in&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;button id&#x3D;&quot;start&quot;&gt;开始&lt;&#x2F;button&gt;    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;script&gt;</span><br><span class="line"></span><br><span class="line">        &#x2F;************** 动画  S *******************&#x2F;</span><br><span class="line"></span><br><span class="line">        const progressIn &#x3D; document.querySelector(&quot;.progress-in&quot;);</span><br><span class="line">        start.onclick &#x3D; function () &#123;                </span><br><span class="line">            progressIn.style.animationPlayState &#x3D; progressIn.style.animationPlayState &#x3D;&#x3D; &#96;running&#96; ? &#39;paused&#39; : &#39;running&#39; </span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;animation动画结束时监听  同理， transiation 的结束状态是 transitionend</span><br><span class="line">        progressIn.addEventListener(&quot;webkitAnimationEnd&quot;, (ele) &#x3D;&gt; &#123;</span><br><span class="line">            console.log(&#96;过渡动画完成：过渡属性$&#123;ele&#125;&#96;);</span><br><span class="line">        &#125;, true);</span><br><span class="line"></span><br><span class="line">        &#x2F;************** 动画  E *******************&#x2F;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/15/express-tools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=558582640,2047403197&fm=27&gp=0.jpg">
      <meta itemprop="name" content="魏彬">
      <meta itemprop="description" content="很乱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/15/express-tools/" class="post-title-link" itemprop="url">express+babel+node-sass-middleware 处理简单页面</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-15 01:08:00 / Modified: 20:13:39" itemprop="dateCreated datePublished" datetime="2021-12-15T01:08:00+08:00">2021-12-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>我们处理一些简单的页面，不愿意使用构建工具，但是又想要使用scss和ES6语法</li>
<li>scss和js(es6)文件在 <code>./css</code> , <code>./js</code> 下 打包出来对应的文件在根目录下</li>
<li>使用babel-cli命令行工具 参考文档 <a target="_blank" rel="noopener" href="https://www.babeljs.cn/docs/babel-cli">https://www.babeljs.cn/docs/babel-cli</a>  安装 <code>npm install --save-dev @babel/core @babel/cli @babel/preset-env</code></li>
<li>安装<code>concurrently</code> 可以同时运行多个命令 不必等待第一个命令完成。</li>
</ul>
<ol>
<li><code>package.json</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;y&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">    &quot;start&quot;: &quot;node server.js&quot;,</span><br><span class="line">    &quot;dev&quot;: &quot;concurrently \&quot;node server.js\&quot; \&quot;npx babel .&#x2F;js&#x2F;index.js --watch --out-file .&#x2F;index-es5.js --presets&#x3D;@babel&#x2F;preset-env\&quot;&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line">  &quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;@babel&#x2F;cli&quot;: &quot;^7.16.0&quot;,</span><br><span class="line">    &quot;@babel&#x2F;core&quot;: &quot;^7.16.5&quot;,</span><br><span class="line">    &quot;babel-preset-env&quot;: &quot;^1.7.0&quot;,</span><br><span class="line">    &quot;express&quot;: &quot;^4.17.1&quot;,</span><br><span class="line">    &quot;node-sass-middleware&quot;: &quot;^0.11.0&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;@babel&#x2F;preset-env&quot;: &quot;^7.16.5&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="2">
<li><code>server.js</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">const express &#x3D; require(&#39;express&#39;)</span><br><span class="line">var path &#x3D; require(&#39;path&#39;)</span><br><span class="line">&#x2F;**node sass *&#x2F;</span><br><span class="line"></span><br><span class="line">var sassMiddleware &#x3D; require(&#39;node-sass-middleware&#39;)</span><br><span class="line"></span><br><span class="line">const app &#x3D; express()</span><br><span class="line"></span><br><span class="line">app.use(</span><br><span class="line">  sassMiddleware(&#123;</span><br><span class="line">    &#x2F;* Options *&#x2F;</span><br><span class="line">    src: path.join(__dirname, &#39;css&#39;),</span><br><span class="line">    dest: __dirname,</span><br><span class="line">    debug: true</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br><span class="line"> app.use(express.static(&#39;.&#x2F;&#39;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(&#39;&#x2F;&#39;, (req, res) &#x3D;&gt; &#123;</span><br><span class="line">  res.sendFile(__dirname + &#39;&#x2F;&#39; + &#39;index.html&#39;) &#x2F;&#x2F;设置&#x2F; 下访问文件位置</span><br><span class="line">&#125;)</span><br><span class="line">&#x2F;&#x2F;&#39;10.200.16.100&#39;</span><br><span class="line">app.listen(&#39;3000&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">  console.log(&#39;your1 app listening at port 3000&#39;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>运行<code>npm run dev</code></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/11/06/git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=558582640,2047403197&fm=27&gp=0.jpg">
      <meta itemprop="name" content="魏彬">
      <meta itemprop="description" content="很乱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/06/git/" class="post-title-link" itemprop="url">git 常用命令解析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-11-06 01:08:00" itemprop="dateCreated datePublished" datetime="2021-11-06T01:08:00+08:00">2021-11-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-11-23 16:37:11" itemprop="dateModified" datetime="2021-11-23T16:37:11+08:00">2021-11-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="撤回方案-git-reset"><a href="#撤回方案-git-reset" class="headerlink" title="撤回方案 git reset"></a>撤回方案 git reset</h3><ol>
<li>reset 命令的原理是根据 commitId 来恢复版本。因为每次提交都会生成一个 commitId，所以说 reset 可以帮你恢复到历史的任何一个版本。</li>
</ol>
<ul>
<li>比如，要撤回到某一次提交，命令是这样：<br><code>$ git reset --hard cc7b5be</code></li>
<li><code>git log</code> 命令查看提交记录，可以看到 commitId 值, 这个值很长，我们取前 7 位即可。</li>
</ul>
<ol start="2">
<li><p>比如你已经commit过了 这时候可能又不想commit了 比如你想修改一下提交的信息</p>
</li>
<li><p> 比如说当前提交，你已经推送到了远程仓库；现在你用 reset 撤回了一次提交，此时本地 git 仓库要落后于远程仓库一个版本。此时你再 push，远程仓库会拒绝，要求你先 pull.如果你需要远程仓库也后退版本，就需要 -f 参数，强制推送，这时本地代码会覆盖远程代码。</p>
</li>
</ol>
<p><code>git reset HEAD^</code> </p>
<ul>
<li>HEAD^ 表示上一个提交，可多次使用。之后再重新 <code>git add . git commit -m &#39;....&#39;</code></li>
</ul>
<h3 id="git-revert"><a href="#git-revert" class="headerlink" title="git revert"></a>git revert</h3><ul>
<li><p>revert 与 reset 的作用一样，都是恢复版本，但是它们两的实现方式不同。</p>
</li>
<li><p>简单来说，reset 直接恢复到上一个提交，工作区代码自然也是上一个提交的代码；而 revert 是新增一个提交，但是这个提交是使用上一个提交的代码。</p>
</li>
<li><p>因此，它们两恢复后的代码是一致的，区别是一个新增提交（revert），一个回退提交（reset）。</p>
</li>
<li><p>正因为 revert 永远是在新增提交，因此本地仓库版本永远不可能落后于远程仓库，可以直接推送到远程仓库，故而解决了 reset 后推送需要加 -f 参数的问题，提高了安全性。</p>
</li>
<li><p>说完了原理，我们再看一下使用方法：<br><code>git revert -n [commitId]</code></p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/11/06/menus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=558582640,2047403197&fm=27&gp=0.jpg">
      <meta itemprop="name" content="魏彬">
      <meta itemprop="description" content="很乱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/06/menus/" class="post-title-link" itemprop="url">vue3 权限菜单</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-11-06 01:08:00" itemprop="dateCreated datePublished" datetime="2021-11-06T01:08:00+08:00">2021-11-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-11-23 15:53:28" itemprop="dateModified" datetime="2021-11-23T15:53:28+08:00">2021-11-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/vue/" itemprop="url" rel="index"><span itemprop="name">vue</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h3><p><a target="_blank" rel="noopener" href="https://github.com/weibsgz/vue3.2.8-">https://github.com/weibsgz/vue3.2.8-</a></p>
<h3 id="菜单权限两种思路"><a href="#菜单权限两种思路" class="headerlink" title="菜单权限两种思路"></a>菜单权限两种思路</h3><ol>
<li>后端返回路由表  前端做个映射 省事了</li>
</ol>
<ul>
<li>简易思路<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    var data &#x3D;  [</span><br><span class="line">      &#123;</span><br><span class="line">        &#39;userManage&#39;:[&#39;user1&#39;,&#39;user2&#39;]</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;roleList&quot;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;pofile&quot;:[&quot;pro1&quot;]</span><br><span class="line">      &#125;</span><br><span class="line">    ]  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    var routeObj &#x3D; &#123;</span><br><span class="line">      &#39;userManage&#39;:&#123;</span><br><span class="line">        name:&#39;userManage&#39;,</span><br><span class="line">        path:&#39;&#x2F;userManage&#x2F;indexPath&#39;,</span><br><span class="line">        component:&quot;&#x2F;userManage&#x2F;Comindex&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;user1&quot;:&#123;</span><br><span class="line">        name:&quot;user1&quot;,</span><br><span class="line">        path:&#39;&#x2F;userManage&#x2F;user1&#x2F;indexPath&#39;,</span><br><span class="line">        component:&quot;&#x2F;userManage&#x2F;user1&#x2F;Comindex&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;user2&quot;:&#123;</span><br><span class="line">        name:&quot;user2&quot;,</span><br><span class="line">        path:&#39;&#x2F;userManage&#x2F;user1&#x2F;indexPath&#39;,</span><br><span class="line">        component:&quot;&#x2F;userManage&#x2F;user1&#x2F;Comindex&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;roleList&quot;:&#123;</span><br><span class="line">        name:&quot;roleList&quot;,</span><br><span class="line">        path:&#39;&#x2F;roleList&#x2F;indexPath&#39;,</span><br><span class="line">        component:&quot;&#x2F;roleList&#x2F;Comindex&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;pofile&quot;:&#123;</span><br><span class="line">        name:&quot;pofile&quot;,</span><br><span class="line">        path:&#39;&#x2F;pofile&#x2F;indexPath&#39;,</span><br><span class="line">        component:&quot;&#x2F;pofile&#x2F;Comindex&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;pro1&quot;:&#123;</span><br><span class="line">        name:&quot;pro1&quot;,</span><br><span class="line">        path:&#39;&#x2F;pofile&#x2F;pro1&#x2F;indexPath&#39;,</span><br><span class="line">        component:&#39;&#x2F;pofile&#x2F;pro1&#x2F;Comindex&#39;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    var generateRoute &#x3D; function(data,routeObj) &#123;</span><br><span class="line">      var route &#x3D; []</span><br><span class="line"></span><br><span class="line">      data.map(function(v,i)&#123;</span><br><span class="line">         if(Object.prototype.toString.call(v) &#x3D;&#x3D;&#x3D; &#39;[object Object]&#39;) &#123;</span><br><span class="line">             var key &#x3D; Object.keys(v)[0];</span><br><span class="line">             var arr &#x3D; v[key];</span><br><span class="line">             var obj &#x3D; routeObj[key]</span><br><span class="line">             obj.children &#x3D; []</span><br><span class="line">             for(var i&#x3D;0; i&lt;arr.length; i++) &#123;</span><br><span class="line">              obj.children.push(routeObj[arr[i]])</span><br><span class="line">             &#125;</span><br><span class="line">             route.push(obj)</span><br><span class="line"></span><br><span class="line">         &#125;</span><br><span class="line">         else &#123;</span><br><span class="line">           route.push(routeObj[v])</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      return route</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   console.log( generateRoute(data,routeObj))</span><br><span class="line">  &lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="2">
<li><p>自己根据后端返回的权限字段，动态生成路由  需要用到addRoutes<br>慕课网项目 权限相关：<a target="_blank" rel="noopener" href="https://www.imooc.com/wiki/vue3/elementAdmin8.html">https://www.imooc.com/wiki/vue3/elementAdmin8.html</a></p>
<p>路由需要公有路由 和 私有路由  我们处理的是根据返回的权限 来动态插入匹配到的私有路由（addRoutes方法）</p>
<p>本项目中  </p>
<ul>
<li><p>把私有路由分成几块（根据不同权限） <code>./store/modules</code></p>
</li>
<li><p>根据权限筛选路由 menus 是后端返回的权限字段 <code>[&quot;userManage&quot;, &quot;roleList&quot;, &quot;permissionList&quot;, &quot;articleRanking&quot;, &quot;articleCreate&quot;]</code><br>privateRoutes是拆分好的私有路由集合 每个私有路由上的name和 menus中的字段对应</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">filterRoutes(context, menus) &#123;</span><br><span class="line">  const routes &#x3D; []</span><br><span class="line">  &#x2F;&#x2F; 路由权限匹配</span><br><span class="line">  menus.forEach(key &#x3D;&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F; 权限名 与 路由的 name 匹配</span><br><span class="line">    routes.push(...privateRoutes.filter(item &#x3D;&gt; item.name &#x3D;&#x3D;&#x3D; key))</span><br><span class="line">  &#125;)</span><br><span class="line">  &#x2F;&#x2F; 最后添加 不匹配路由进入 404</span><br><span class="line">  routes.push(&#123;</span><br><span class="line">    path: &#39;&#x2F;:catchAll(.*)&#39;,</span><br><span class="line">    redirect: &#39;&#x2F;404&#39;</span><br><span class="line">  &#125;)</span><br><span class="line">  context.commit(&#39;setRoutes&#39;, routes) &#x2F;&#x2F;  vuex中state.routes &#x3D; [...publicRoutes, ...newRoutes]</span><br><span class="line">  return routes</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<ul>
<li><p><code>src/permission.js</code> （路由守卫） 中 使用addRoutes方法动态添加路由，最后添加404页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;&#x2F; 判断用户资料是否获取</span><br><span class="line">      &#x2F;&#x2F; 若不存在用户信息，则需要获取用户信息</span><br><span class="line">      if (!store.getters.hasUserInfo) &#123;</span><br><span class="line">        &#x2F;&#x2F; 触发获取用户信息的 action，并获取用户当前权限 （通过接口返回权限菜单）</span><br><span class="line">        const &#123; permission &#125; &#x3D; await store.dispatch(&#39;user&#x2F;getUserInfo&#39;)</span><br><span class="line">        &#x2F;&#x2F; 处理用户权限，筛选出需要添加的权限</span><br><span class="line">        const filterRoutes &#x3D; await store.dispatch(</span><br><span class="line">          &#39;permission&#x2F;filterRoutes&#39;,</span><br><span class="line">          permission.menus</span><br><span class="line">        )</span><br><span class="line">        &#x2F;&#x2F; 利用 addRoute 循环添加</span><br><span class="line">        filterRoutes.forEach(item &#x3D;&gt; &#123;</span><br><span class="line">          router.addRoute(item)</span><br><span class="line">        &#125;)</span><br><span class="line">        &#x2F;&#x2F; 添加完动态路由之后，需要在进行一次主动跳转</span><br><span class="line">        return next(to.path)</span><br><span class="line">      &#125;</span><br><span class="line">      next()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>退出登录时，添加的路由表并未被删除 需要退出时候重置路由表</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 初始化路由表</span><br><span class="line"> *&#x2F;</span><br><span class="line">export function resetRouter() &#123;</span><br><span class="line">  if (</span><br><span class="line">    store.getters.userInfo &amp;&amp;</span><br><span class="line">    store.getters.userInfo.permission &amp;&amp;</span><br><span class="line">    store.getters.userInfo.permission.menus</span><br><span class="line">  ) &#123;</span><br><span class="line">    const menus &#x3D; store.getters.userInfo.permission.menus</span><br><span class="line">    menus.forEach((menu) &#x3D;&gt; &#123;</span><br><span class="line">      router.removeRoute(menu)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/23/express-mongoose/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=558582640,2047403197&fm=27&gp=0.jpg">
      <meta itemprop="name" content="魏彬">
      <meta itemprop="description" content="很乱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/23/express-mongoose/" class="post-title-link" itemprop="url">express连接mlab(mongoose)实现TODOS</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-23 14:13:23" itemprop="dateCreated datePublished" datetime="2021-04-23T14:13:23+08:00">2021-04-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-04-27 17:31:16" itemprop="dateModified" datetime="2021-04-27T17:31:16+08:00">2021-04-27</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li><p>项目地址<br><code>https://github.com/weibsgz/nodeDemo/tree/main/express/todo</code></p>
</li>
<li><p>mlab 注册账号 申请一个免费的 mongo 仓库 （添加用户等操作）</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/23/express_node/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=558582640,2047403197&fm=27&gp=0.jpg">
      <meta itemprop="name" content="魏彬">
      <meta itemprop="description" content="很乱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/02/23/express_node/" class="post-title-link" itemprop="url">使用express跨域代理外网域名接口，拿到本地使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-02-23 14:13:23" itemprop="dateCreated datePublished" datetime="2021-02-23T14:13:23+08:00">2021-02-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-04-25 09:57:31" itemprop="dateModified" datetime="2021-04-25T09:57:31+08:00">2021-04-25</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li>本地页面使用</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;GBK&quot; &#x2F;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot; &#x2F;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;script</span><br><span class="line">      type&#x3D;&quot;text&#x2F;javascript&quot;</span><br><span class="line">      src&#x3D;&quot;&#x2F;&#x2F;asserts.xcarimg.com&#x2F;resource&#x2F;common&#x2F;jquery-1.8.3.min.js&quot;</span><br><span class="line">    &gt;&lt;&#x2F;script&gt;</span><br><span class="line">  &lt;&#x2F;head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    this. is index.html</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">      &#x2F;&#x2F;URL 10.200.16.100 anywhere启动的域名 所以服务端也可以设置这个域名保持同源，</span><br><span class="line">      &#x2F;&#x2F;如果服务端随便起域名，需要设置允许跨域</span><br><span class="line">      const url &#x3D; &#39;http:&#x2F;&#x2F;10.200.16.100:4000&#x2F;getAutoHome&#39;</span><br><span class="line">      $.ajax(&#123;</span><br><span class="line">        url: url,</span><br><span class="line">        success: function (res) &#123;</span><br><span class="line">          console.log(res)</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line">  &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>抓取目标页面接口</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">const axios &#x3D; require(&#39;axios&#39;)</span><br><span class="line">const express &#x3D; require(&#39;express&#39;)</span><br><span class="line">const app &#x3D; express()</span><br><span class="line"></span><br><span class="line">var Iconv &#x3D; require(&#39;iconv-lite&#39;)</span><br><span class="line">&#x2F;&#x2F;主页 啥都没干</span><br><span class="line">app.get(&#39;&#x2F;&#39;, (req, res) &#x3D;&gt; &#123;</span><br><span class="line">  res.json(&#123;</span><br><span class="line">    err: 0,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;设置请求中间件 设置响应头信息</span><br><span class="line">app.all(&#39;*&#39;, function (req, res, next) &#123;</span><br><span class="line">  res.setHeader(&#39;Access-Control-Allow-Origin&#39;, &#39;http:&#x2F;&#x2F;10.200.16.100:7777&#39;)</span><br><span class="line">  res.setHeader(&#39;Access-Control-Allow-Methods&#39;, &#39;GET, POST&#39;)</span><br><span class="line">  res.setHeader(</span><br><span class="line">    &#39;Access-Control-Allow-Headers&#39;,</span><br><span class="line">    &#39;Content-Type,Content-Length, Authorization, Accept,X-Requested-With&quot;&#39;</span><br><span class="line">  )</span><br><span class="line">  res.setHeader(&#39;Content-Type&#39;, &#39;application&#x2F;json;charset&#x3D;utf-8&#39;)</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; app.use(express.json())</span><br><span class="line">&#x2F;&#x2F; app.use(express.urlencoded(&#123; extended: false &#125;))</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;设置路由，前端就请求这个路由接口</span><br><span class="line"></span><br><span class="line">app.get(&#39;&#x2F;getAutoHome&#39;, (request, response) &#x3D;&gt; &#123;</span><br><span class="line">  &#x2F;&#x2F; 开始请求你要爬的外域名接口</span><br><span class="line">  const url &#x3D; &#39;https:&#x2F;&#x2F;www.yourWebSite.com&#x2F;any&#x2F;....&#39;</span><br><span class="line">  &#x2F;&#x2F;他的接口所需要的参数</span><br><span class="line">  const params &#x3D; &#123;</span><br><span class="line">    cityid: &#39;330600&#39;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  axios</span><br><span class="line">    .get(url, &#123;</span><br><span class="line">      params: &#123; ...params &#125;,</span><br><span class="line">      &#x2F;&#x2F; 如果接口返回的 是  gb2312的 需要用&#39;iconv-lite&#39; 插件 结合设置这个属性使用</span><br><span class="line">      responseType: &#39;arraybuffer&#39;,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        &#x2F;&#x2F;伪造来源</span><br><span class="line">        referer: &#39;https:&#x2F;&#x2F;www.yourWebSite.com&#x2F;&#39;,</span><br><span class="line">        origin: &#39;https:&#x2F;&#x2F;www.yourWebSite.com&#x2F;&#39;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    .then((res) &#x3D;&gt; &#123;</span><br><span class="line">      const data &#x3D; res.data</span><br><span class="line">      &#x2F;&#x2F;因为接口请求的是GB2312的 所以需要转为UTF-8返回前端</span><br><span class="line">      const _json &#x3D; Iconv.decode(Buffer.from(data), &#39;gb2312&#39;)</span><br><span class="line">      const html &#x3D; Iconv.encode(_json, &#39;utf8&#39;).toString()</span><br><span class="line">      console.log(html)</span><br><span class="line">      response.json(JSON.parse(html))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;这个IP 是anywhere生成的静态服务地址 也可以随便起个域名，那么要设置跨域允许</span><br><span class="line">app.listen(4000, &#39;10.200.16.100&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">  console.log(&#39;server is listenning at port 4000&#39;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">魏彬</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
